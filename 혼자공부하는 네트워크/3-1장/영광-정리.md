# 3-1. LAN을 넘어서는 네트워크 계층

LAN을 넘어선 다른 네트워크와 통신하기 위해서 ***네트워크 계층***  역할이 필수.

## 데이터 링크 계층의 한계

### 첫째, 물리 계층과 데이터 링크 계층만으로는 다른 네트워크까지의 도달 경로를 파악하기 어려움

- 라우팅 - 최적의 경로로 패킷 이동을 결정하는 것
- 라우터 - 라우팅을 수행하는 장비

### 둘째, MAC 주소만으로는 모든 네트워크에 속한 호스트의 위치를 특정하기 어렵습니다.

- 수신의 역할을 하는 MAC주소, 수신지 역할을 하는 정보는 IP주소
- MAC 주소를 물리주소, IP주소는 논리 주소, DHCP라는 프로토콜을 통해 자동할당받음

## 인터넷 프로토콜

### IP 주소 형태

- IP 주소는 4바이트로 주소를 표현하고, 자릿수당 8비트로 0~255까지 표현한다. 이것을 ‘***옥텟*** ’
    
    ex) 192.168.1.1
    

### IP의 기능

- IP 주소 기능
    - IP 주소를 바탕으로 송수신 대상을 지정하는 것을 의미
- IP 단편화
    - 전송하고자 하는 킷의 크기가 MTU라는 최대 전송단위보다 클 경우 복수의 패킷으로 나누는 것을 의미

### MTU

- 한 번에 전송 가능한 IP패킷 최대 크기를 의미합니다.
    - MTU 크기는 1500바이트 이며, 이를 넘어선 패킷은  수신지에 도착하면 재조합

### IPV4

2계층 프레임의 데이터 필드에는 프레임 헤더가 들어가고 

| 프레임헤더 | 프레임헤더 | 프레임헤더 | 프레임헤더 | 프레임 펭이러드 | 트레일러 |
| --- | --- | --- | --- | --- | --- |
| 프리앰블 | 수신지mac주소 | 송신지mac주소 | 타입/길이 | 데이터 | FCS |

| i | p | 패 | 킷 | 헤 | 더 |  |  |  |  |  |  |  |  | 페이로드 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 버전 | 헤더길이 | 서비스 유형 | 패킷길이 | 식별자 | 플래그 | 단편화 오프셋 | TTL | 프로토콜 | 헤더 체크섬 | 송신지 ip주소 | 수신지 ip주소 | 옵션 | 패딩 | 데이터 |

### 1. 식별자

- 패킷에 할당된 번호, 쪼개져서 수신지에 도착한 ipv4패킷이 어떤 메시지에서 쪼개졌는지 인식하기 위해 식별자를 사용

### 2. 플래그

- 총 세 개의 비트로 구성된 필드
    - 첫 비트는 0
    - 하나는 DF로 1이면 IP단편화를 수행하지않고, 0이면 IP단편화가 수행 가능

### 3. 단편화 오프셋

- 단편화된 패킷의 순서를 나타내는 것

### 4. TTL

- 패킷의 수명을 나타냄. 패킷이 라우터에 한번 전달되는 것을 홉이라고 하는데 1홉마다 1씩 줄어듬

### 5. 프로토콜

- ip패킷의 프로토콜은 상위 계층의 프로토콜이 무엇인지 나타내는 필드.

### 6. 송신지 IP주소, 수신지 IP주소

## IPv6

- IPv4의 43억개라는 한계를 넘기기 위해 등장한 IPv6
    - 16비트 주소로 표현할 수 있고, 2**128이라는 무한에 가까운 갯수를 할당할 수있음.
- 다음헤더, 홉 제한, 송신지ip주소, 수신지 ip주소 4개로 이루어짐

### 다음헤더

- 상위계층의 프로토콜을 가르키거나 확장 헤더를 가리킴
- 기본헤더 이외에 추가로 확장헤더를 가질 수 있음

### 홉 제한

- TTL과 유사하게 패킷의 수명을 나타내는 필드

### 송신지 IP주소, 수신지 IP주소

## ARP

호스트의 ip주소는 알지만, MAC주소는 알지 못하는 상황에 ARP 사용

- ip주소를 이용해 MAC주소를 알아내는 프로토콜 == ARP

ARP의 동작과정은 

ARP 요청 - ARP응답 - ARP 테이블 갱신

### ARP요청

- A가 네트워크 내의 모든 호스트에게 브로드 캐스트 메시지 (ARP 요청)을 보냄

### ARP응답

- 해당하는 MAC주소를 가진 B는 반응하지만 나머지는 이를 무시함

### ARP 테이블 갱신

- ARP를 활용할 수 있는 모든 호스트는 ARP 테이블이라는 정보를 유지함.

- 위의 요청 응답과정이 이루어지면 그 정보를 기록하는것