# 3장 네트워크계층

노션 링크 https://www.notion.so/3-a7cfea87af034162b3515f8d651edca5?pvs=4

![스크린샷 2024-06-24 오후 6.09.21.png](3%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%82%E1%85%A6%E1%84%90%E1%85%B3%E1%84%8B%E1%85%AF%E1%84%8F%E1%85%B3%E1%84%80%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%BC%20a7cfea87af034162b3515f8d651edca5/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-06-24_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_6.09.21.png)

데이터 링크 계층 : MAC주소  송수신지 특정 가능

물리계층 + 데이터 링크 계층 → LAN을 넘어서 통신 불가능

## **WHY??**

1. 물리계층과 데이터 링크 계층의 장비로 라우팅 불가 

→ but, 네트워크 계층 가능

LAN끼리 패킷 이동 → **가장 최적의 경로를 결정해야함 : 라우팅**

**라우팅을 수행하는 장비 : 라우터**

1. MAC주소만으로는 모든 네트워크에 속한 호스트의 위치를 특정하기 어렵다

MAC주소 : NIC(네트워크 인터페이스)에 할당된 개인정보

→ 수신인 역할 NOT 수신지

따라서 수신지인 IP주소 사용

IP주소 : 논리주소, DHCP이용해 자동으로 할당받거나 호스트가 직접 할당하거나 혹은 한 호스트가 복수의 ip주소 소유 가능

MAC주소 : 물리주소, NIC마다 할당되는 고정된 주소

**즉 , 네트워크간 통신은 ip주소를 이용해 수신지를 설정하게 하고 해당 수신지까지 최적의 경로를 결정하는 라우팅이 네트워크 계층에서 이루어져서 해당 계층에서 가능함.**

### 인터넷 프로토콜 : IP

- 4byte(32bit) 주소 표현가능. 0~255 범위 안의 네개의 10진수로 표기 → 각 10진수는 .(점)으로 구분. 각 점으로 구분된 8bit를 옥텟이라고 함.

EX) 192.168.1.1

- **IP주소지정 : IP주소를 바탕으로 송수신 대상을 지정하는것**
- **IP단편화 : 전송하고자 하는 패킷의 크기를 MTU크기 이하의 복수의 패킷으로 나누는것.**

MTU : 한번에 전송가능한 IP패킷의 최대 크기

- **IP풀은 부족하기 때문에 나온 기술이 프라이빗 IP와 퍼블릭 IP**

라우팅을 할때는 프라이빗 IP를 퍼블릭 IP로 바꿔주는 것이 필요 → NAT기술

주로 가정용 공유기는 NAT기능 내장 : 로컬에서의 사설 IP는 공유기를 거쳐 퍼블릭 IP로 변경되고 외부망에 전송.

![스크린샷 2024-06-24 오후 7.08.44.png](3%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%82%E1%85%A6%E1%84%90%E1%85%B3%E1%84%8B%E1%85%AF%E1%84%8F%E1%85%B3%E1%84%80%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%BC%20a7cfea87af034162b3515f8d651edca5/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-06-24_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_7.08.44.png)

- **IPv4 : 데이터링크 계층의 이더넷 프레임에 페이로드로 데이터 필드에 명시**

핵심 필드 :  식별자, 플래그, 단편화 오프셋, TTL, 프로토콜, 송수신지 IP주소

![스크린샷 2024-06-24 오후 6.38.10.png](3%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%82%E1%85%A6%E1%84%90%E1%85%B3%E1%84%8B%E1%85%AF%E1%84%8F%E1%85%B3%E1%84%80%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%BC%20a7cfea87af034162b3515f8d651edca5/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-06-24_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_6.38.10.png)

1. 식별자: 패킷에 할당된 번호로, 단편화 과정에서 분해된 패킷을 재조합하는 데 필요
2. 플래그: 3개의 비트로 구성된 필드로, IP 단편화 수행 여부와 개수를 결정
    - 첫 번째 비트는 항상 0
    - 나머지 두 개 중 DF 비트는 0과 1의 구분으로 단편화 수행 여부를 결정(1이면 단편화 금지, 0이면 단편화 가능).
    - MF 비트는 남은 단편화 패킷의 여부를 표현(0이면 마지막 패킷, 1이면 남은 패킷 있음).
3. 단편화 오프셋: 단편화되기 전 패킷의 초기 데이터에서 몇 번째로 떨어진 패킷인지를 나타냄. 수신지에 단편화된 패킷들이 순서대로 도착하지 않아 초기 데이터에서 몇 번째인지 알려주는 것.
4. TTL: 패킷의 수명으로, 패킷이 하나의 라우터를 거칠 때마다 1씩 감소. TTL이 0으로 떨어지면 패킷은 폐기.
5. 프로토콜: 상위 계층의 프로토콜을 나타낸다 (예: 전송 계층의 TCP(6), UDP(17)).
6. 송수신지 IP 주소: 송수신지의 IPv4 주소를 알 수 있음.

- **IPv6 : 16Byte로 주소를 표현할 수 있고, 콜론(:) 구분된 8개의 그룹의 16진수로 표기.**

IPv4의 유한성을 IPv6로 무한에 가깝게 바꿈.

![스크린샷 2024-06-24 오후 6.55.40.png](3%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%82%E1%85%A6%E1%84%90%E1%85%B3%E1%84%8B%E1%85%AF%E1%84%8F%E1%85%B3%E1%84%80%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%BC%20a7cfea87af034162b3515f8d651edca5/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-06-24_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_6.55.40.png)

1. 다음헤더 : 상위계층의 프로토콜, 확장 헤더

IPv6의 헤더 : 기본 헤더

추가적인 헤더 정보 필요 → 확장헤더를 추가로 가짐.

1. 홉 제한 : 패킷의 수명을 나타냄
2. IP송수신지 

ARP : IP주소를 통해 MAC주소를 알아내는 프로토콜. 동일 네트워크 내에 있는 송수신 대상의 ip주소를 통해 MAC주소를 알아낼 수 있음.

ARP요청 → ARP 응답 → ARP 테이블 갱신